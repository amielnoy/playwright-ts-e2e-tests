version: 2.1
jobs:
  build:
    docker:
      - image: mcr.microsoft.com/playwright:v1.36.1-focal
    working_directory: ~/app
    steps:
      - checkout

      - run:
          command: npm i -D @playwright/test

      - run:
          command: npx playwright install chromium

      - run:
          command: npx playwright test --project=chromium --reporter=line,allure-playwright

      - run:
          command: |
            mkdir -p ~/artifacts
            cp -r ./allure-report ~/artifacts/

      - run:
          command: |
            npx allure generate allure-report --clean
            npx allure report generate -c -o allure-results
            npx allure report open -o allure-results --port 8080 http://35.171.159.248

workflows:
  build:
    jobs:
      - build
